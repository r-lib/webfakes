<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>A webfakes response object — webfakes_response • webfakes</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A webfakes response object — webfakes_response"><meta name="description" content="webfakes creates a webfakes_response object for every incoming HTTP
request. This object is passed to every matched route and middleware,
until the HTTP response is sent. It has reference semantics, so handlers
can modify it."><meta property="og:description" content="webfakes creates a webfakes_response object for every incoming HTTP
request. This object is passed to every matched route and middleware,
until the HTTP response is sent. It has reference semantics, so handlers
can modify it."><meta name="robots" content="noindex"><script defer data-domain="webfakes.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">webfakes</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.3.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/introduction.html">Intro</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/how-to.html">How-to</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/glossary.html">Glossary</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../httpbin.html">The builtin httpbin app's API</a></li>
    <li><a class="dropdown-item" href="../articles/oauth.html">OAuth2.0 webfakes apps</a></li>
    <li><a class="dropdown-item" href="../articles/internals.html">Webfakes internals</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/webfakes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>A webfakes response object</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/webfakes/blob/main/R/response.R" class="external-link"><code>R/response.R</code></a></small>
      <div class="d-none name"><code>webfakes_response.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>webfakes creates a <code>webfakes_response</code> object for every incoming HTTP
request. This object is passed to every matched route and middleware,
until the HTTP response is sent. It has reference semantics, so handlers
can modify it.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Fields and methods:</p><ul><li><p><code>app</code>: The <code>webfakes_app</code> object itself.</p></li>
<li><p><code>req</code>: The request object.</p></li>
<li><p><code>headers_sent</code>: Whether the response headers were already sent out.</p></li>
<li><p><code>locals</code>: Local variables, the are shared between the handler
functions. This is for the end user, and not for the middlewares.</p></li>
<li><p><code>delay(secs)</code>: delay the response for a number of seconds. If a
handler calls <code>delay()</code>, the same handler will be called again,
after the specified number of seconds have passed. Use the <code>locals</code>
environment to distinguish between the calls. If you are using
<code>delay()</code>, and want to serve requests in parallel, then you probably
need a multi-threaded server, see <code><a href="server_opts.html">server_opts()</a></code>.</p></li>
<li><p><code>add_header(field, value)</code>: Add a response header. Note that
<code>add_header()</code> may create duplicate headers. You usually want
<code>set_header()</code>.</p></li>
<li><p><code>get_header(field)</code>: Query the currently set response headers. If
<code>field</code> is not present it return <code>NULL</code>.</p></li>
<li><p><code>on_response(fun)</code>: Run the <code>fun</code> handler function just before the
response is sent out. At this point the headers and the body are
already properly set.</p></li>
<li><p><code>redirect(path, status = 302)</code>: Send a redirect response. It sets
the <code>Location</code> header, and also sends a <code>text/plain</code> body.</p></li>
<li><p><code>render(view, locals = list())</code>: Render a template page. Searches
for the <code>view</code> template page, using all registered engine extensions,
and calls the first matching template engine. Returns the filled
template.</p></li>
<li><p><code>send(body)</code>. Send the specified body. <code>body</code> can be a raw vector,
or HTML or other text. For raw vectors it sets the content type to
<code>application/octet-stream</code>.</p></li>
<li><p><code>send_json(object = NULL, text = NULL, ...)</code>: Send a JSON response.
Either <code>object</code> or <code>text</code> must be given. <code>object</code> will be converted
to JSON using <code><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">jsonlite::toJSON()</a></code>. <code>...</code> are passed to
<code><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">jsonlite::toJSON()</a></code>. It sets the content type appropriately.</p></li>
<li><p><code>send_file(path, root = ".")</code>: Send a file. Set <code>root = "/"</code> for
absolute file names. It sets the content type automatically, based
on the extension of the file, if it is not set already.</p></li>
<li><p><code>send_status(status)</code>: Send the specified HTTP status code, without
a response body.</p></li>
<li><p><code>send_chunk(data)</code>: Send a chunk of a response in chunked encoding.
The first chunk will automatically send the HTTP response headers.
Webfakes will automatically send a final zero-lengh chunk, unless
<code>$delay()</code> is called.</p></li>
<li><p><code>set_header(field, value)</code>: Set a response header. If the headers have
been sent out already, then it throws a warning, and does nothing.</p></li>
<li><p><code>set_status(status)</code>: Set the response status code. If the headers
have been sent out already, then it throws a warning, and does nothing.</p></li>
<li><p><code>set_type(type)</code>: Set the response content type. If it contains a <code>/</code>
character then it is set as is, otherwise it is assumed to be a file
extension, and the corresponding MIME type is set. If the headers have
been sent out already, then it throws a warning, and does nothing.</p></li>
<li><p><code>add_cookie(name, value, options)</code>: Adds a cookie to the response.
<code>options</code> is a named list, and may contain:</p><ul><li><p><code>domain</code>: Domain name for the cookie, not set by default.</p></li>
<li><p><code>expires</code>: Expiry date in GMT. It must be a POSIXct object, and
will be formatted correctly.</p></li>
<li><p>'http_only': if TRUE, then it sets the 'HttpOnly' attribute, so
Javasctipt cannot access the cookie.</p></li>
<li><p><code>max_age</code>: Maximum age, in number of seconds.</p></li>
<li><p><code>path</code>: Path for the cookie, defaults to "/".</p></li>
<li><p><code>same_site</code>: The 'SameSite' cookie attribute. Possible values are
"strict", "lax" and "none".</p></li>
<li><p><code>secure</code>: if TRUE, then it sets the 'Secure' attribute.</p></li>
</ul></li>
<li><p><code>clear_cookie(name, options = list())</code>: clears a cookie. Typically,
web browsers will only clear a cookie if the options also match.</p></li>
<li><p><code>write(data)</code>: writes (part of) the body of the response. It also
sends out the response headers, if they haven't been sent out before.</p></li>
</ul><p>Usually you need one of the <code>send()</code> methods, to send out the HTTP
response in one go, first the headers, then the body.</p>
<p>Alternatively, you can use <code>$write()</code> to send the response in parts.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="webfakes_request.html">webfakes_request</a> for the webfakes request object.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># This is how you can see the request and response objects:</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="fu"><a href="new_app.html">new_app</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"/"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">res</span><span class="op">$</span><span class="fu">send</span><span class="op">(</span><span class="st">"done"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;webfakes_app&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> routes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   get /</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fields and methods:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   all(path, ...)         # add route for *all* HTTP methods</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   delete(path, ...)      # add route for DELETE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   engine(ext, engine)    # add template engine for file extension</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   head(path, ...)        # add route for HEAD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   listen(port)           # start web app on port</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   patch(path, ...)       # add route for PATCH</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   post(path, ...)        # add route for POST</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   put(path, ...)         # add route for PUT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   use(...)               # add middleware</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   locals                 # app-wide shared data</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # see ?webfakes_app for all methods</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now start this app on a port:</span></span></span>
<span class="r-in"><span><span class="co"># app$listen(3000)</span></span></span>
<span class="r-in"><span><span class="co"># and connect to it from a web browser: http://127.0.0.1:3000</span></span></span>
<span class="r-in"><span><span class="co"># You can also use another R session to connect:</span></span></span>
<span class="r-in"><span><span class="co"># httr::GET("http://127.0.0.1:3000")</span></span></span>
<span class="r-in"><span><span class="co"># or the command line curl tool:</span></span></span>
<span class="r-in"><span><span class="co"># curl -v http://127.0.0.1:3000</span></span></span>
<span class="r-in"><span><span class="co"># The app will stop while processing the request.</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

