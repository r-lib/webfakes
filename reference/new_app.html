<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Create a new web application"><title>Create a new web application — new_app • webfakes</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.5/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.5/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a new web application — new_app"><meta property="og:description" content="Create a new web application"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="webfakes.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">webfakes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/introduction.html">Intro</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/how-to.html">How-to</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/glossary.html">Glossary</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../httpbin.html">The builtin httpbin app's API</a>
    <a class="dropdown-item" href="../articles/oauth.html">OAuth2.0 webfakes apps</a>
    <a class="dropdown-item" href="../articles/internals.html">Webfakes internals</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lib/webfakes/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create a new web application</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/webfakes/blob/HEAD/R/app.R" class="external-link"><code>R/app.R</code></a></small>
      <div class="d-none name"><code>new_app.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a new web application</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">new_app</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A new <code>webfakes_app</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The typical workflow of creating a web application is:</p><ol><li><p>Create a <code>webfakes_app</code> object with <code>new_app()</code>.</p></li>
<li><p>Add middleware and/or routes to it.</p></li>
<li><p>Start is with the <code>webfakes_app$listen()</code> method, or start it in
another process with <code><a href="new_app_process.html">new_app_process()</a></code>.</p></li>
<li><p>Make queries to the web app.</p></li>
<li><p>Stop it via <code>CTRL+C</code> / <code>ESC</code>, or, if it is running in another
process, with the <code>$stop()</code> method of <code><a href="new_app_process.html">new_app_process()</a></code>.</p></li>
</ol><p>A web application can be</p><ul><li><p>restarted,</p></li>
<li><p>saved to disk,</p></li>
<li><p>copied to another process using the callr package, or a similar way,</p></li>
<li><p>embedded into a package,</p></li>
<li><p>extended by simply adding new routes and/or middleware.</p></li>
</ul><p>The webfakes API is very much influenced by the
<a href="http://expressjs.com/" class="external-link">express.js</a> project.</p><div class="section">
<h3 id="create-web-app-objects">Create web app objects<a class="anchor" aria-label="anchor" href="#create-web-app-objects"></a></h3>


<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/new_app.html">new_app</a></span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<p><code>new_app()</code> returns a <code>webfakes_app</code> object the has the methods listed
on this page.</p>
<p>An app is an environment with S3 class <code>webfakes_app</code>.</p>
</div>

<div class="section">
<h3 id="the-handler-stack">The handler stack<a class="anchor" aria-label="anchor" href="#the-handler-stack"></a></h3>


<p>An app has a stack of handlers. Each handler can be a route or
middleware. The differences between the two are:</p><ul><li><p>A route is bound to one or more paths on the web server. Middleware
is not (currently) bound to paths, but run for all paths.</p></li>
<li><p>A route is usually (but not always) the end of the handler stack for
a request. I.e. a route takes care of sending out the response to
the request. Middleware typically performs some action on the request
or the response, and then the next handler in the stack is invoked.</p></li>
</ul></div>

<div class="section">
<h3 id="routes">Routes<a class="anchor" aria-label="anchor" href="#routes"></a></h3>


<p>The following methods define routes. Each method corresponds to the
HTTP verb with the same name, except for <code>app$all()</code>, which creates a
route for all HTTP methods.</p>
<p></p><div class="sourceCode r"><pre><code>app$all(path, ...)
app$delete(path, ...)
app$get(path, ...)
app$head(path, ...)
app$patch(path, ...)
app$post(path, ...)
app$put(path, ...)
... (see list below)
</code></pre><p></p></div><ul><li><p><code>path</code> is a path specification, see 'Path specification' below.</p></li>
<li><p><code>...</code> is one or more handler functions. These will be placed in the
handler stack, and called if they match an incoming HTTP request.
See 'Handler functions' below.</p></li>
</ul><p>webfakes also has methods for the less frequently used HTTP verbs:
<code>CONNECT</code>, <code>MKCOL</code>, <code>OPTIONS</code>, <code>PROPFIND</code>, <code>REPORT</code>. (The method
names are always in lowercase.)</p>
<p>If a request is not handled by any routes (or handler functions in
general), then webfakes will send a simple HTTP 404 response.</p>
</div>

<div class="section">
<h3 id="middleware">Middleware<a class="anchor" aria-label="anchor" href="#middleware"></a></h3>


<p><code>app$use()</code> adds a middleware to the handler stack. A middleware is
a handler function, see 'Handler functions' below. webfakes comes with
middleware to perform common tasks:</p><ul><li><p><code><a href="mw_etag.html">mw_etag()</a></code> adds an <code>Etag</code> header to the response.</p></li>
<li><p><code><a href="mw_log.html">mw_log()</a></code> logs each requests to standard output, or another connection.</p></li>
<li><p><code><a href="mw_raw.html">mw_raw()</a></code> parses raw request bodies.</p></li>
<li><p><code><a href="mw_text.html">mw_text()</a></code> parses plain text request bodies.</p></li>
<li><p><code><a href="mw_json.html">mw_json()</a></code> parses JSON request bodies.</p></li>
<li><p><code><a href="mw_multipart.html">mw_multipart()</a></code> parses multipart request bodies.</p></li>
<li><p><code><a href="mw_static.html">mw_static()</a></code> serves static files from a directory.</p></li>
<li><p><code><a href="mw_urlencoded.html">mw_urlencoded()</a></code> parses URL encoded request bodies.</p></li>
</ul><p></p><div class="sourceCode r"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">use</span><span class="op">(</span><span class="va">...</span>, .first <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre><p></p></div><ul><li><p><code>...</code> is a set of (middleware) handler functions. They are added to
the handler stack, and called for every HTTP request. (Unless an HTTP
response is created before reaching this point in the handler stack.)</p></li>
<li><p><code>.first</code> set to <code>TRUE</code> is you want to add the handler function
to the bottom of the stack.</p></li>
</ul></div>

<div class="section">
<h3 id="handler-functions">Handler functions<a class="anchor" aria-label="anchor" href="#handler-functions"></a></h3>


<p>A handler function is a route or middleware. A handler function is
called by webfakes with the incoming HTTP request and the outgoing
HTTP response objects (being built) as arguments. The handler function
may query and modify the members of the request and/or the response
object. If it returns the string <code>"next"</code>, then it is <em>not</em> a terminal
handler, and once it returns, webfakes will move on to call the next
handler in the stack.</p>
<p>A typical route:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"/user/:id"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">id</span> <span class="op">&lt;-</span> <span class="va">req</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">id</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">res</span><span class="op">$</span></span>
<span>    <span class="fu">set_status</span><span class="op">(</span><span class="fl">200L</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">set_header</span><span class="op">(</span><span class="st">"X-Custom-Header"</span>, <span class="st">"foobar"</span><span class="op">)</span><span class="op">$</span></span>
<span>    <span class="fu">send_json</span><span class="op">(</span><span class="va">response</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div><ul><li><p>The handler belongs to an API path, which is a wildcard path in
this case. It matches <code>/user/alice</code>, <code>/user/bob</code>, etc. The handler
will be only called for GET methods and matching API paths.</p></li>
<li><p>The handler receives the request (<code>req</code>) and the response (<code>res</code>).</p></li>
<li><p>It sets the HTTP status, additional headers, and sends the data.
(In this case the <code>webfakes_response$send_json()</code> method automatically
converts <code>response</code> to JSON and sets the <code>Content-Type</code> and
<code>Content-Length</code> headers.</p></li>
<li><p>This is a terminal handler, because it does <em>not</em> return <code>"next"</code>.
Once this handler function returns, webfakes will send out the HTTP
response.</p></li>
</ul><p>A typical middleware:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">use</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="st">"next"</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div><ul><li><p>There is no HTTP method and API path here, webfakes will call the
handler for each HTTP request.</p></li>
<li><p>This is not a terminal handler, it does return <code>"next"</code>, so after it
returns webfakes will look for the next handler in the stack.</p></li>
</ul></div>

<div class="section">
<h3 id="errors">Errors<a class="anchor" aria-label="anchor" href="#errors"></a></h3>


<p>If a handler function throws an error, then the web server will return
a HTTP 500 <code>text/plain</code> response, with the error message as the
response body.</p>
</div>

<div class="section">
<h3 id="request-and-response-objects">Request and response objects<a class="anchor" aria-label="anchor" href="#request-and-response-objects"></a></h3>


<p>See <a href="webfakes_request.html">webfakes_request</a> and <a href="webfakes_response.html">webfakes_response</a> for the methods of the
request and response objects.</p>
</div>

<div class="section">
<h3 id="path-specification">Path specification<a class="anchor" aria-label="anchor" href="#path-specification"></a></h3>


<p>Routes are associated with one or more API paths. A path specification
can be</p><ul><li><p>A "plain" (i.e. without parameters) string. (E.g. <code>"/list"</code>.)</p></li>
<li><p>A parameterized string. (E.g. <code>"/user/:id"</code>.)</p></li>
<li><p>A regular expression created via <code><a href="new_regexp.html">new_regexp()</a></code> function.</p></li>
<li><p>A list or character vector of the previous ones. (Regular expressions
must be in a list.)</p></li>
</ul></div>

<div class="section">
<h3 id="path-parameters">Path parameters<a class="anchor" aria-label="anchor" href="#path-parameters"></a></h3>


<p>Paths that are specified as parameterized strings or regular expressions
can have parameters.</p>
<p>For parameterized strings the keys may contain letters, numbers and
underscores. When webfakes matches an API path to a handler with a
parameterized string path, the parameters will be added to the
request, as <code>params</code>. I.e. in the handler function (and subsequent
handler functions, if the current one is not terminal), they are
available in the <code>req$params</code> list.</p>
<p>For regular expressions, capture groups are also added as parameters.
It is best to use named capture groups, so that the parameters are in
a named list.</p>
<p>If the path of the handler is a list of parameterized strings or
regular expressions, the parameters are set according to the first
matching one.</p>
</div>

<div class="section">
<h3 id="templates">Templates<a class="anchor" aria-label="anchor" href="#templates"></a></h3>


<p>webfakes supports templates, using any template engine. It comes with
a template engine that uses the glue package, see <code><a href="tmpl_glue.html">tmpl_glue()</a></code>.</p>
<p><code>app$engine()</code> registers a template engine, for a certain file
extension. The <code>$render()</code> method of <a href="webfakes_response.html">webfakes_response</a>
can be called from the handler function to evaluate a template from a
file.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">engine</span><span class="op">(</span><span class="va">ext</span>, <span class="va">engine</span><span class="op">)</span></span></code></pre><p></p></div><ul><li><p><code>ext</code>: the file extension for which the template engine is added.
It should not contain the dot. E.g. <code>"html"', </code>"brew"`.</p></li>
<li><p><code>engine</code>: the template engine, a function that takes the file path
(<code>path</code>) of the template, and a list of local variables (<code>locals</code>)
that can be used in the template. It should return the result.</p></li>
</ul><p>An example template engine that uses glue might look like this:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">engine</span><span class="op">(</span><span class="st">"txt"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">path</span>, <span class="va">locals</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readChar.html" class="external-link">readChar</a></span><span class="op">(</span><span class="va">path</span>, nchars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span>, useBytes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue_data</a></span><span class="op">(</span><span class="va">locals</span>, <span class="va">txt</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div>
<p>(The built-in <code><a href="tmpl_glue.html">tmpl_glue()</a></code> engine has more features.)</p>
<p>This template engine can be used in a handler:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"/view"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="va">txt</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="fu">render</span><span class="op">(</span><span class="st">"test"</span><span class="op">)</span></span>
<span> <span class="va">res</span><span class="op">$</span></span>
<span>   <span class="fu">set_type</span><span class="op">(</span><span class="st">"text/plain"</span><span class="op">)</span><span class="op">$</span></span>
<span>   <span class="fu">send</span><span class="op">(</span><span class="va">txt</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div>
<p>The location of the templates can be set using the <code>views</code> configuration
parameter, see the <code>$set_config()</code> method below.</p>
<p>In the template, the variables passed in as <code>locals</code>, and also the
response local variables (see <code>locals</code> in <a href="webfakes_response.html">webfakes_response</a>), are
available.</p>
</div>

<div class="section">
<h3 id="starting-and-stopping">Starting and stopping<a class="anchor" aria-label="anchor" href="#starting-and-stopping"></a></h3>


<p></p><div class="sourceCode r"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">listen</span><span class="op">(</span>port <span class="op">=</span> <span class="cn">NULL</span>, opts <span class="op">=</span> <span class="fu"><a href="../reference/server_opts.html">server_opts</a></span><span class="op">(</span><span class="op">)</span>, cleanup <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre><p></p></div><ul><li><p><code>port</code>: port to listen on. When <code>NULL</code>, the operating system will
automatically select a free port.</p></li>
<li><p><code>opts</code>: options to the web server. See <code><a href="server_opts.html">server_opts()</a></code> for the
list of options and their default values.</p></li>
<li><p><code>cleanup</code>: stop the server (with an error) if the standard input
of the process is closed. This is handy when the app runs in a
<code><a href="https://callr.r-lib.org/reference/r_session.html" class="external-link">callr::r_session</a></code> subprocess, because it stops the app (and the
subprocess) if the main process has terminated.</p></li>
</ul><p>This method does not return, and can be interrupted with <code>CTRL+C</code> / <code>ESC</code>
or a SIGINT signal. See <code><a href="new_app_process.html">new_app_process()</a></code> for interrupting an app that
is running in another process.</p>
<p>When <code>port</code> is <code>NULL</code>, the operating system chooses a port where the
app will listen. To be able to get the port number programmatically,
before the listen method blocks, it advertises the selected port in a
<code>webfakes_port</code> condition, so one can catch it:</p>
<p>webfakes by default binds only to the loopback interface at 127.0.0.1, so
the webfakes web app is never reachable from the network.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">withCallingHandlers</a></span><span class="op">(</span></span>
<span>  <span class="va">app</span><span class="op">$</span><span class="fu">listen</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="st">"webfakes_port"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">msg</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">msg</span><span class="op">$</span><span class="va">port</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="logging">Logging<a class="anchor" aria-label="anchor" href="#logging"></a></h3>


<p>webfakes can write an access log that contains an entry for all incoming
requests, and also an error log for the errors that happen while
the server is running. This is the default behavior for local app
(the ones started by <code>app$listen()</code> and for remote apps (the ones
started via <code><a href="new_app_process.html">new_app_process()</a></code>:</p><ul><li><p>Local apps do not write an access log by default.</p></li>
<li><p>Remote apps write an access log into the
<code>&lt;tmpdir&gt;/webfakes/&lt;pid&gt;/access.log</code> file, where <code>&lt;tmpdir&gt;</code> is the
session temporary directory of the <em>main process</em>, and <code>&lt;pid&gt;</code> is
the process id of the <em>subprocess</em>.</p></li>
<li><p>Local apps write an error log to <code>&lt;tmpdir&gt;/webfakes/error.log</code>, where
<code>&lt;tmpdir&gt;</code> is the session temporary directory of the current process.</p></li>
<li><p>Remote app write an error log to the <code>&lt;tmpdir&gt;/webfakes/&lt;pid&gt;/error.log</code>,
where <code>&lt;tmpdir&gt;</code> is the session temporary directory of the
<em>main process</em> and <code>&lt;pid&gt;</code> is the process id of the <em>subprocess</em>`.</p></li>
</ul><p>See <code><a href="server_opts.html">server_opts()</a></code> for changing the default logging behavior.</p>
</div>

<div class="section">
<h3 id="shared-app-data">Shared app data<a class="anchor" aria-label="anchor" href="#shared-app-data"></a></h3>


<p></p><div class="sourceCode r"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="va">locals</span></span></code></pre><p></p></div>
<p>It is often useful to share data between handlers and requests in an
app. <code>app$locals</code> is an environment that supports this. E.g. a
middleware that counts the number of requests can be implemented as:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">use</span>(<span class="cf">function</span>(req, res) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  locals <span class="ot">&lt;-</span> req<span class="sc">$</span>app<span class="sc">$</span>locals</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(locals<span class="sc">$</span>num)) locals<span class="sc">$</span>num <span class="ot">&lt;-</span> 0L</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  locals<span class="sc">$</span>num <span class="ot">&lt;-</span> locals<span class="sc">$</span>num <span class="sc">+</span> 1L</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"next"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre><p></p></div>
<p><a href="webfakes_response.html">webfakes_response</a> objects also have a <code>locals</code> environment, that is
initially populated as a copy of <code>app$locals</code>.</p>
</div>

<div class="section">
<h3 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a></h3>


<p></p><div class="sourceCode r"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">get_config</span><span class="op">(</span><span class="va">key</span><span class="op">)</span></span>
<span><span class="va">app</span><span class="op">$</span><span class="fu">set_config</span><span class="op">(</span><span class="va">key</span>, <span class="va">value</span><span class="op">)</span></span></code></pre><p></p></div><ul><li><p><code>key</code>: configuration key.</p></li>
<li><p><code>value</code>: configuration value.</p></li>
</ul><p>Currently used configuration values:</p><ul><li><p><code>views</code>: path where webfakes searches for templates.</p></li>
</ul></div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="webfakes_request.html">webfakes_request</a> for request objects, <a href="webfakes_response.html">webfakes_response</a> for
response objects.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># see example web apps in the `/examples` directory in</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"webfakes"</span>, <span class="st">"examples"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/home/runner/work/_temp/Library/webfakes/examples"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="fu">new_app</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">use</span><span class="op">(</span><span class="fu"><a href="mw_log.html">mw_log</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"/hello"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">res</span><span class="op">$</span><span class="fu">send</span><span class="op">(</span><span class="st">"Hello there!"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="new_regexp.html">new_regexp</a></span><span class="op">(</span><span class="st">"^/hi(/.*)?$"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">res</span><span class="op">$</span><span class="fu">send</span><span class="op">(</span><span class="st">"Hi indeed!"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">post</span><span class="op">(</span><span class="st">"/hello"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">req</span>, <span class="va">res</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">res</span><span class="op">$</span><span class="fu">send</span><span class="op">(</span><span class="st">"Got it, thanks!"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;webfakes_app&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> routes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   use *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   get /hello</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   get &lt;webfakes_regexp&gt; "^/hi(/.*)?$"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   post /hello</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fields and methods:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   all(path, ...)         # add route for *all* HTTP methods</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   delete(path, ...)      # add route for DELETE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   engine(ext, engine)    # add template engine for file extension</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   head(path, ...)        # add route for HEAD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   listen(port)           # start web app on port</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   patch(path, ...)       # add route for PATCH</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   post(path, ...)        # add route for POST</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   put(path, ...)         # add route for PUT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   use(...)               # add middleware</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   locals                 # app-wide shared data</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # see ?webfakes_app for all methods</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Start the app with: app$listen()</span></span></span>
<span class="r-in"><span><span class="co"># Or start it in another R session: new_app_process(app)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>, RStudio, Pbc..</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer></body></html>

